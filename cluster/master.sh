#!/bin/bash
set -euo pipefail
IFS=$'\n\t'

function start_hadoop() {
    echo
    echo "***************************************************************************"
    echo service ssh start
    echo "***************************************************************************"
    service ssh start

    echo
    echo "***************************************************************************"
    echo hdfs namenode -format
    echo "***************************************************************************"
    echo 'Y' | hdfs namenode -format

    echo
    echo "***************************************************************************"
    echo start-dfs.sh
    echo "***************************************************************************"
    start-dfs.sh

    echo
    echo "***************************************************************************"
    echo start-yarn.sh
    echo "***************************************************************************"
    start-yarn.sh

    echo
    echo "***************************************************************************"
    echo sleep 30
    echo "***************************************************************************"
    sleep 30

    while true; do
        echo
        echo "***************************************************************************"
        echo hdfs dfsadmin -report
        echo "***************************************************************************"
        hdfs dfsadmin -report
        
        sleep 60
    done
}

function stop_hadoop() {
    echo
    echo "***************************************************************************"
    echo stop-yarn.sh
    echo "***************************************************************************"
    stop-yarn.sh

    echo
    echo "***************************************************************************"
    echo stop-dfs.sh
    echo "***************************************************************************"
    stop-dfs.sh

    echo
    echo "***************************************************************************"
    echo service ssh stop
    echo "***************************************************************************"
    service ssh stop
}

trap stop_hadoop SIGTERM

start_hadoop
